# React Native 调试指南

## 当前状态

✅ Android Studio 模拟器已启动  
✅ React Native Metro Bundler 运行在 8081 端口

## 快速开始

### 方法一：使用命令行运行（推荐）

在项目根目录运行：

```bash
npm run android
```

或者：

```bash
npx react-native run-android
```

这会：
1. 构建 Android APK
2. 安装到模拟器
3. 自动启动应用

### 方法二：在 Android Studio 中运行

1. 打开 Android Studio
2. 打开项目：`File -> Open -> 选择 android 文件夹`
3. 等待 Gradle 同步完成
4. 点击工具栏的绿色运行按钮（▶️）或按 `Shift + F10`
5. 选择已启动的模拟器

## 调试方法

### 1. 查看 Metro Bundler 日志

Metro Bundler 终端会显示：
- 编译错误
- 警告信息
- Bundle 构建进度

### 2. 查看 Android Logcat 日志

**在 Android Studio 中**：
1. 打开 `View -> Tool Windows -> Logcat`
2. 过滤标签：`ReactNativeJS` 或 `ReactNative`

**使用命令行**：
```bash
adb logcat *:S ReactNativeJS:V ReactNative:V
```

### 3. 使用 Chrome DevTools 调试 JavaScript

#### 启用调试菜单

在模拟器中：
1. 按 `Ctrl + M`（Windows）或 `Cmd + M`（Mac）
2. 或者摇动设备（模拟器菜单 -> Device -> Shake）
3. 选择 "Debug"

#### 打开 Chrome DevTools

1. 自动打开 Chrome 浏览器（`http://localhost:8081/debugger-ui/`）
2. 或者手动访问：`http://localhost:8081/debugger-ui/`
3. 在 Chrome DevTools 中可以：
   - 设置断点
   - 查看变量
   - 执行 JavaScript 代码
   - 查看网络请求

### 4. 使用 React Native Debugger（推荐）

安装独立的调试工具：

```bash
# 下载并安装 React Native Debugger
# Windows: 从 https://github.com/jhen0409/react-native-debugger/releases 下载
```

使用步骤：
1. 启动 React Native Debugger
2. 在模拟器中按 `Ctrl + M` -> 选择 "Debug"
3. 在 React Native Debugger 中可以：
   - 查看 Redux/Jotai 状态
   - 查看网络请求
   - 使用 React DevTools

### 5. 使用 Flipper（可选）

Flipper 是 Facebook 的调试平台：

1. 安装 Flipper：https://fbflipper.com/
2. 安装 React Native Flipper 插件
3. 启动 Flipper，它会自动连接到应用

## 常用调试技巧

### 查看应用日志

在代码中使用 `console.log`：

```typescript
console.log('SwellNovalApp: 调试信息', { data });
```

在 Logcat 中过滤 `SwellNovalApp` 查看日志。

### 热重载（Hot Reload）

默认已启用：
- 修改代码后保存
- 应用会自动刷新（无需重新构建）

### 快速刷新（Fast Refresh）

- 保存文件后自动刷新
- 保持组件状态

### 重新加载应用

在模拟器中：
- 按 `R` 键两次（快速按两次）
- 或者 `Ctrl + M` -> "Reload"

### 清除缓存重新构建

```bash
# 清除 Metro bundler 缓存
npm start -- --reset-cache

# 清除 Android 构建缓存
cd android
./gradlew clean

# 重新运行
npm run android
```

## 调试 Jotai 状态

### 使用 React DevTools

1. 安装 React DevTools 浏览器扩展
2. 在 Chrome DevTools 中打开 "Components" 标签
3. 查看组件树和状态

### 使用 Jotai DevTools（如果已安装）

```typescript
import { useAtomDevtools } from 'jotai-devtools';

// 在组件中使用
useAtomDevtools(atomName);
```

## 网络调试

### 查看网络请求

1. 在 Chrome DevTools 中打开 "Network" 标签
2. 或者使用 Flipper 的 Network 插件
3. 或者使用 React Native Debugger 的网络面板

### 配置代理

如果需要调试 API 请求：
1. 使用 Charles Proxy 或 Fiddler
2. 配置 Android 模拟器代理：`Settings -> Wi-Fi -> 长按 Wi-Fi -> Modify -> Advanced -> Proxy`

## 性能调试

### 查看性能指标

1. 在 Chrome DevTools 中打开 "Performance" 标签
2. 使用 React DevTools Profiler
3. 在模拟器中：`Ctrl + M` -> "Show Perf Monitor"

### 内存调试

```bash
# 查看内存使用
adb shell dumpsys meminfo com.swellnovalapp
```

## 常见问题排查

### 1. 应用无法连接到 Metro Bundler

**症状**：红屏错误 "Unable to connect to Metro"

**解决方法**：
```bash
# 检查端口是否被占用
netstat -ano | findstr :8081

# 重启 Metro bundler
npm start -- --reset-cache
```

### 2. 修改代码后没有更新

**解决方法**：
- 确保 Metro bundler 正在运行
- 在模拟器中按 `R` 两次重新加载
- 或者 `Ctrl + M` -> "Reload"

### 3. 构建错误

**解决方法**：
```bash
cd android
./gradlew clean
cd ..
npm run android
```

### 4. 端口冲突

如果 8081 端口被占用：

```bash
# Windows 查看占用
netstat -ano | findstr :8081

# 使用其他端口
npm start -- --port 8082
```

然后在模拟器中：`Ctrl + M` -> "Settings" -> 修改端口为 8082

## 调试快捷键

| 操作 | Windows/Linux | Mac |
|------|--------------|-----|
| 打开调试菜单 | `Ctrl + M` | `Cmd + M` |
| 重新加载 | `R` (按两次) | `R` (按两次) |
| 打开开发者菜单 | 摇动设备 | 摇动设备 |

## 推荐调试流程

1. **启动 Metro Bundler**：
   ```bash
   npm start
   ```

2. **在另一个终端运行应用**：
   ```bash
   npm run android
   ```

3. **打开 Chrome DevTools**：
   - 在模拟器中按 `Ctrl + M` -> "Debug"
   - 或访问 `http://localhost:8081/debugger-ui/`

4. **查看日志**：
   - Android Studio Logcat
   - Metro Bundler 终端
   - Chrome DevTools Console

5. **调试代码**：
   - 在 Chrome DevTools 中设置断点
   - 使用 `console.log` 输出调试信息
   - 使用 React DevTools 查看组件状态

## 下一步

现在你可以：
1. 运行 `npm run android` 安装应用到模拟器
2. 在模拟器中打开应用
3. 按 `Ctrl + M` 打开调试菜单
4. 开始调试！
